<!-- minimized version ==> see homepage of London Hydro -->

<div id="counterbox">
  <p> How many seconds since last refresh: </p>
  <p id="timer"> </p>
</div>

<div id="map_canvas"></div>
 
<style>
  #counterbox {
    padding: 1em;
    margin-left: 3em;
    top: 2em;
    display: flex;
  }
  #map_canvas {
    height: 30%;
    width: 30%;
    left: 20%;
    top: 10%;
  }

    @media screen and (max-width: 40em) { 
    #map_canvas {
      width:100%;
    }

  }
  
</style>
 
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script>
  // London's coordinates
  var mylocation = {
    'latitude':  42.9837,
    'longitude': -81.2497
  };
  var map;
  /**
 * The AddBox function adds the image to the map
 * This constructor takes the control DIV as an argument.
 * @constructor
 */
function AddBox(controlDiv, map) {
  // Set CSS for the control border
  var controlUI = document.createElement('div');
  controlUI.style.backgroundColor = '#fff';
  controlUI.style.border = '2px solid #fff';
  controlUI.style.borderRadius = '3px';
  controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
  controlUI.style.marginBottom = '10px';
  controlUI.style.marginRight = '15px';
  controlDiv.appendChild(controlUI);  
  // Set CSS for the control interior
  var controlImg = document.createElement('div');
  controlImg.innerHTML = '<img src="https://cloud.githubusercontent.com/assets/9067177/7816552/0e167444-039d-11e5-86ce-0a9e9fceb9cb.png" alt="legend of London">';
  controlUI.appendChild(controlImg); 
}
  // starts the program
  function initialize() {
    var myLatlng = new google.maps.LatLng( mylocation.latitude, mylocation.longitude );
    var mapOptions = {
      maxZoom: 13,
      minZoom: 10,
      zoom: 11,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoomControl: true,
      // made the zoom small style
      zoomControlOptions: {
        style: google.maps.ZoomControlStyle.SMALL
      },
      streetViewControl: false,
      mapTypeControl: false
    }
    var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
    // This needs to be the Full URL - not a relative URL
    var kmlPath = "http://storage.googleapis.com/cloud-sql-dev/territory_polygon.kml";
    // Add unique number to this url - as with images - to avoid caching issues during development
    var urlSuffix = (new Date).getTime().toString();
    var layer = new google.maps.KmlLayer(kmlPath + '?' + urlSuffix );
    layer.setMap(map);
    var testKMLPath = "http://storage.googleapis.com/cloud-sql-dev/kml-test-outages/outage_polygons_2015_05_15.kml";
    var urlSuffixTwo = (new Date).getTime().toString();
    // creates outages based on kml file
    var outages = new google.maps.KmlLayer(testKMLPath + '?' +urlSuffixTwo);
    outages.setMap(map);
    var timer = document.getElementById('timer');
    timeCount = 0;
     var i = 0;
  var kmlStrings = ["outage_polygons_2015_05_01.kml","outage_polygons_2015_05_03.kml", "outage_polygons_2015_05_01.kml", "outage_polygons_2015_05_07.kml","outage_polygons_2015_05_10.kml", "outage_polygons_2015_05_01.kml","outage_polygons_2015_05_14.kml", "outage_polygons_2015_05_15.kml"];
    // increments time every second and refreshes the map every 10 seconds
    setInterval(function() {
      timeCount++;
      timer.innerHTML = timeCount;
        if ((timeCount / 10) == 1) {
                i++;
         // what if there are no outages, would it display empty screen?
          outages.setMap(null);
          testKMLPath = "http://storage.googleapis.com/cloud-sql-dev/kml-test-outages/";
          urlSuffixTwo = (new Date).getTime().toString();
          // creates outages based on kml file
          outages = new google.maps.KmlLayer(testKMLPath + kmlStrings[i] + '?' +urlSuffixTwo);
          outages.set('preserveViewport', true);
          outages.setMap(map);
          timeCount = 0;
              
           }
    }, 1000);
    /* TRY OUT CASES INSTEAD OF IF */
     
    
     // Create the DIV to hold the control and
      // call the AddBox() constructor passing
      // in this DIV.
    var addLegendDiv = document.createElement('div');
    var legend = new AddBox(addLegendDiv, map);
    addLegendDiv.index = 1;
    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(addLegendDiv);
  
 
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>
