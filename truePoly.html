<div id="map_canvas"></div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script src="./moment.js"></script>
<script>
var placemarkArray = [];
    var xmlRequest = new XMLHttpRequest();
    xmlRequest.open("GET","http://mding5692.github.io/LondonHydro-GoogleMapsAPI/outages.kml", false);
    xmlRequest.send();
    
    xmlDoc=xmlRequest.responseXML;
    var x=xmlDoc.getElementsByTagName("Placemark");
    var date_format = "MMM DD, hh:mm a";
    
    var i = 0;
    // gets the event number
    var event_number_value = x[i].getElementsByTagName("SimpleData")[2].childNodes[0].nodeValue;
    // gets outage start time
    var outage_time_value = x[i].getElementsByTagName("SimpleData")[3].childNodes[0].nodeValue;
    var outage_time_moment = moment(outage_time_value);
    // converts to humanly readable form
    var outage_time = outage_time_moment.format(date_format);
    // copy down the coordinates
    // gets estimated restoration time
    var restoration_time_value = x[i].getElementsByTagName("SimpleData")[5].childNodes[0].nodeValue;
        if (restoration_time_value === "2001-01-01T00:00:00") {
        var restoration_time = "Not yet determined";
        } else {
        var restoration_time_moment = moment(restoration_time_value);
        
        // converts to humanly readable form
        var restoration_time = restoration_time_moment.format(date_format);
        }
        // gets the coordinates of the polygon
        var coords = x[i].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;
        var coordinate = coords.split(",0 ");

        var coordJoined = coordinate.join();
        //document.write(coordJoined);
        var coordAgain = coordJoined.split(",");
        // gets the colour of the polygon
        var colour = x[i].getElementsByTagName("styleUrl")[0].childNodes[0].nodeValue;
        var fillColour, borderColour;
        
        // determines the colour
        if (colour === "#Style1") {
        fillColour = '7f4cf5fc';
        borderColour = 'ff4cf5fc';
        } else if (colour === "#Style2") {
        fillColour = '7f3293f0';
        borderColour = 'ff3293f0';
        } else {
            
        fillColour = '7fc98bb4';
        borderColour = 'ffc98bb4';
        }
        
        // creates object array
        var objArray = {

            objects: []
        };

        // adds object to array
        var obj = {
        eventID: event_number_value,
        offTime: outage_time,
        restoreTime: restoration_time,
        fill: fillColour,
        border: borderColour
        };

        objArray.objects += obj;
        document.write(objArray.objects[0].eventID);
        // remember to put the last element zero to add to the array later on or just store as random variable
       
       // create a coordinate Array
        var polygonCoords = [];
        // creates a new LatLng
       var j = 0;
        var z = j + 1;
    while (z < coordinate.length) {
        if ((z%2) === 0) {
        var co1 = parseFloat(coordAgain[z]);
        var co2 = parseFloat(coordAgain[j]);
        var newLatLng = new google.maps.LatLng(co1,co2);
        
        polygonCoords.push(newLatLng);
    } else {
        var co1 = parseFloat(coordAgain[j]);
        var co2 = parseFloat(coordAgain[z]);
        var newLatLng = new google.maps.LatLng(co1,co2);
        polygonCoords.push(newLatLng);
    }
        z++;
        j++;
        }
        // removes last element as its useless
        polygonCoords.pop();
        //document.write(polygonCoords);

        // store the polygonCoords in an array
        // create the map before all this and then load
        // a new polygon created from coordinates and then
        // attach infowindow with their information 
        // which means that their info should be stored in the json object

        function initialize() {
    
        var mylocation = {
        'latitude':  42.9837,
        'longitude': -81.2497
        };
        
        var myLatlng = new google.maps.LatLng( mylocation.latitude, mylocation.longitude );
            var mapOptions = {
            maxZoom: 13,
            minZoom: 10,
            zoom: 11,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            zoomControl: true,
            // made the zoom small style
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            },
            scaleControl: true,
            scaleControlOptions: {
                position: google.maps.ControlPosition.LEFT_BOTTOM
            },
            streetViewControl: false,
            mapTypeControl: false
            }
            var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
            var newPoly = new google.maps.Polygon({
            paths: polygonCoords,
            strokeColor: borderColour,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: fillColour,
            fillOpacity: 0.35
            })
            newPoly.setMap(map); 
            // add the polygon to a polygon array
        }

        google.maps.event.addDomListener(window, 'load', initialize);


</script>
